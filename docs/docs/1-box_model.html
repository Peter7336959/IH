---
title: "暴露空間模式(Box Models)暴露風險評估"
encoding: "UTF-8"
---

<style type="text/css">
  body { font-family: "Microsoft JhengHei", Arial, sans-serif; }
  .container { display: flex; width: 100%; }
  .input-panel { width: 60%; padding: 15px; }
  .result-panel { width: 40%; padding: 15px; }
  .form-group { margin-bottom: 10px; }
  label { display: inline-block; width: 180px; }
  input[type="number"], select { width: 120px; }
  .section { margin-top: 20px; border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
  .section-title { font-weight: bold; margin-bottom: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  table, th, td { border: 1px solid #ccc; padding: 5px; }
  .risk-level-1 { background-color: #90EE90; } /* 低風險 */
  .risk-level-2 { background-color: #FFFFE0; } /* 中低風險 */
  .risk-level-3 { background-color: #FFB6C1; } /* 中高風險 */
  .risk-level-4 { background-color: #FF0000; color: white; } /* 高風險 */
  .plot-container { margin-top: 20px; }
  .recommendation { margin-top: 15px; padding: 10px; background-color: #f0f0f0; border-radius: 5px; }
</style>

<div class="container">
  <div class="input-panel">
    <h2>暴露空間模式(Box Models)暴露風險評估</h2>
    
    <form id="exposureForm">
      <div class="section">
        <div class="section-title">基本參數</div>
        <div class="form-group">
          <label for="CA_room_0">CA,room,0 (mg/m³):</label>
          <input type="number" id="CA_room_0" value="0" step="0.001">
        </div>
        <div class="form-group">
          <label for="CA_in">CA,in (mg/m³):</label>
          <input type="number" id="CA_in" value="0" step="0.001">
        </div>
        <div class="form-group">
          <label for="GA">GA (mg/min):</label>
          <input type="number" id="GA" value="10" step="0.001">
        </div>
        <div class="form-group">
          <label for="Q">Q (m³/min):</label>
          <input type="number" id="Q" value="5" step="0.001">
        </div>
        <div class="form-group">
          <label for="V">V (m³):</label>
          <input type="number" id="V" value="50" step="0.001">
        </div>
        <div class="form-group">
          <label for="t">t (min):</label>
          <input type="number" id="t" value="60" step="1">
        </div>
        <div class="form-group">
          <label for="MW">分子量 (g/mol):</label>
          <input type="number" id="MW" value="100" step="0.001">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">環境條件 (非NTP條件時填寫)</div>
        <div class="form-group">
          <label for="P">大氣壓力 (mmHg):</label>
          <input type="number" id="P" value="760" step="0.1">
        </div>
        <div class="form-group">
          <label for="T">絕對溫度 (K):</label>
          <input type="number" id="T" value="298" step="0.1">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">暴露限值</div>
        <div class="form-group">
          <label for="TWA_value">TWA (8小時):</label>
          <input type="number" id="TWA_value" value="100" step="0.001">
          <select id="TWA_unit">
            <option value="mg_m3">mg/m³</option>
            <option value="ppm">ppm</option>
          </select>
        </div>
        <div class="form-group">
          <label for="STEL_value">STEL (15分鐘):</label>
          <input type="number" id="STEL_value" value="150" step="0.001">
          <select id="STEL_unit">
            <option value="mg_m3">mg/m³</option>
            <option value="ppm">ppm</option>
          </select>
        </div>
        <div class="form-group">
          <label for="IDLH_value">IDLH:</label>
          <input type="number" id="IDLH_value" value="500" step="0.001">
          <select id="IDLH_unit">
            <option value="mg_m3">mg/m³</option>
            <option value="ppm">ppm</option>
          </select>
        </div>
        <div class="form-group">
          <label for="OEL_value">OEL:</label>
          <input type="number" id="OEL_value" value="80" step="0.001">
          <select id="OEL_unit">
            <option value="mg_m3">mg/m³</option>
            <option value="ppm">ppm</option>
          </select>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">計算功能選擇</div>
        <div class="form-group">
          <input type="radio" id="func1" name="function" value="1" checked>
          <label for="func1" style="width: auto;">功能1：時間濃度(經過時間t的空間濃度)</label>
        </div>
        <div class="form-group">
          <input type="radio" id="func2" name="function" value="2">
          <label for="func2" style="width: auto;">功能2：穩態濃度(空間濃度穩定平衡)</label>
        </div>
        <div class="form-group">
          <input type="radio" id="func3" name="function" value="3">
          <label for="func3" style="width: auto;">功能3：衰減濃度(化學品停止逸散)</label>
        </div>
        <div class="form-group">
          <input type="radio" id="func4" name="function" value="4">
          <label for="func4" style="width: auto;">功能4：平均暴露濃度(時間濃度加權)</label>
        </div>
      </div>
      
      <div class="form-group">
        <button type="button" onclick="calculate()">計算</button>
        <button type="button" onclick="window.print()">列印</button>
      </div>
    </form>
    
    <div class="plot-container">
      <div id="concentrationPlot"></div>
    </div>
  </div>
  
  <div class="result-panel">
    <h3>計算結果</h3>
    <div id="results"></div>
    
    <h3>風險分級</h3>
    <div id="riskAssessment"></div>
    
    <h3>建議控制措施</h3>
    <div id="recommendations"></div>
    
    <h3>暴露空間模式示意圖</h3>
    <div style="text-align: center;">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGAUExURf///wAAAPf39+fn59fX18fHx7e3t6+vr6enp5+fn5eXl4+Pj4eHh39/f3d3d29vb2dnZ19fX1dXV09PT0dHR0NDQz8/Pzs7OzMzMy8vLysrKycnJyMjIx8fHxsbGxcXFxMTEw8PDwsLCwcHBwMDAv7+/vr6+vLy8urq6ubm5uLi4t7e3tra2tbW1tLS0s7OzsrKysbGxsLCwr6+vrq6urKysq6urqqqqqampqKiop6enpqampaWlpKSko6OjoqKioaGhoKCgn5+fnp6enZ2dnJycm5ubmpqamZmZmJiYl5eXlpaWlZWVlJSUk5OTkpKSkZGRkJCQj4+Pjo6OjY2NjIyMi4uLioqKiYmJiIiIh4eHhoaGhYWFhISEg4ODgoKCgYGBgICAf39/fn5+fX19fHx8e3t7enp6eXl5eHh4d3d3dnZ2dXV1dHR0c3NzcnJycXFxcHBwb29vbm5ubW1tbGxsa2trampqaWlpaGhoZ2dnZmZmZWVlZGRkY2NjYmJiYWFhYGBgX19fXl5eXV1dXFxcW1tbWlpaWVlZWFhYV1dXVlZWVVVVVFRUU1NTUlJSUVFRUFBQT09PTk5OTU1NTExMS0tLSkpKSUlJSEhIR0dHRkZGRUVFREREQ0NDQkJCQUFBQEBAPz8/Pj4+PT09PDw8Ozs7Ojo6OTk5ODg4Nzc3NjY2NTU1NDQ0MzMzMjIyMTExMDAwLy8vLi4uLS0tLCwsKysrKioqKSkpKCgoJycnJiYmJSUlJCQkIyMjIiIiISEhICAgHx8fHh4eHR0dHBwcGxsbGhoaGRkZGBgYFxcXFhYWFRUVFBQUExMTEhISEREREBAQDw8PDg4ODQ0NDAwMCwsLCgoKCQkJCAgIBwcHBgYGBQUFBAQEAwMDAgICAQEBAAAACP4AAQgcSLCgwYMIEypcyLChw4cQI0qcSLGixYsYM2rcyLGjx48gQ4ocSbKkyZMoU6pcybKly5cwY8qcSbOmzZs4c+rcybOnz59AgwodSrSo0aNIkypdyrSp06dQo0qdSrWq1atYs2rdyrWr169gw4odS7as2bNo06pdy7at27dw48qdS7eu3bt48+rdy7ev37+AAwseTLiw4cOIEytezLix48eQI0ueTLmy5cuYM2vezLmz58+gQ4seTbq06dOoU6tezbq169ewY8ueTbu27du4c+vezbu379/AgwsfTry48ePIkytfzry58+fQo0ufTr269evYs2vfzr279+/gw/6LH0++vPnz6NOrX8++vfv38OPLn0+/vv37+PPr38+/v///AAYo4IAEFmjggQgmqOCCDDbo4IMQRijhhBRWaOGFGGao4YYcdujhhyCGKOKIJJZo4okopqjiiiy26OKLMMYo44w01mjjjTjmqOOOPPbo449ABinkkEQWaeSRSCap5JJMNunkk1BGKeWUVFZp5ZVYZqnlllx26eWXYIYp5phklmnmmWimqeaabLbp5ptwxinnnHTWaeedeOap55589unnn4AGKuighBZq6KGIJqrooow26uijkEYq6aSUVmrppZhmqummnHbq6aeghirqqKSWauqpqKaq6qqsturqq/6wxirrrLTWauutuOaq66689urrr8AGK+ywxBZr7LHIJqvsssw26+yz0EYr7bTUVmvttdhmq+223Hbr7bfghivuuOSWa+656Kar7rrstuvuu/DGK++89NZr77345qvvvvz26++/AAcs8MAEF2zwwQgnrPDCDDfs8MMQRyzxxBRXbPHFGGes8cYcd+zxxyCHLPLIJJds8skop6zyyiy37PLLMMcs88w012zzzTjnrPPOPPfs889ABy300EQXbfTRSCet9NJMN+3001BHLfXUVFdt9dVYZ6311lx37fXXYIct9thkl2322WinrfbabLft9ttwxy333HTXbffdeOet9/7efPft99+ABy744IQXbvjhiCeu+OKMN+7445BHLvnklFdu+eWYZ6755px37vnnoIcu+uikl2766ainrvrqrLfu+uuwxy777LTXbvvtuOeu++689+7778AHL/zwxBdv/PHIJ6/88sw37/zz0Ecv/fTUV2/99dhnr/323Hfv/ffghy/++OSXb/756Kev/vrst+/++/DHL//89Ndv//3456///vz37///AAygAAdIwAIa8IAITKACF8jABjrwgRCMoAQnSMEKWvCCGMygBjfIwQ568IMgDKEIR0jCEprwhChMoQpXyMIWuvCFMIyhDGdIwxra8IY4zKEOd8jDHvrwh0AMohD/h0jEIhrxiEhMohKXyMQmOvGJUIyiFKdIxSpa8YpYzKIWt8jFLnrxi2AMoxjHSMYymvGMaEyjGtfIxja68Y1wjKMc50jHOtrxjnjMox73yMc++vGPgAykIAdJyEIa8pCITKQiF8nIRjrykZCMpCQnSclKWvKSmMykJjfJyU568pOgDKUoR0nKUprylKhMpSpXycpWuvKVsIylLGdJy1ra8pa4zKUud8nLXvryl8AMpjCHScxiGvOYyEymMpfJzGY685nQjKY0p0nNalrzmtjMpja3yc1uevOb4AynOMdJznKa85zoTKc618nOdrrznfCMpzznSc962vOe+MynPvfJ/89++vOfAA2oQAdK0IIa9KAITahCF8rQhjr0oRCNqEQnStGKWvSiGM2oRjfK0Y569KMgDalIR0rSkpr0pChNqUpXytKWuvSlMI2pTGdK05ra9KY4zalOd8rTnvr0p0ANqlCHStSiGvWoSE2qUpfK1KY69alQjapUp0rVqlr1qljNqla3ytWuevWrYA2rWMdK1rKa9axoTata18rWtrr1rXCNq1znSte62vWueM2rXvfK17769a+ADaxgB0vYwhr2sIhNrGIXy9jGOvaxkI2sZCdL2cpa9rKYzaxmN8vZznr2s6ANrWhHS9rSmva0qE2talfL2ta69rWwja1sZ0vb2v/a9ra4za1ud8vb3vr2t8ANrnCHS9ziGve4yE2ucpfL3OY697nQja50p0vd6lr3utjNrna3y93ueve74A2veMdL3vKa97zoTa9618ve9rr3vfCNr3znS9/62ve++M2vfvfL3/76978ADrCAB0zgAhv4wAhOsIIXzOAGO/jBEI6whCdM4Qpb+MIYzrCGN8zhDnv4wyAOsYhHTOISm/jEKE6xilfM4ha7+MUwjrGMZ0zjGtv4xjjOsY53zOMe+/jHQA6ykIdM5CIb+chITrKSl8zkJjv5yVCOspSnTOUqW/nKWM6ylrfM5S57+ctgDrOYx0zmMpv5zGhOs5rXzOY2u/n/zXCOs5znTOc62/nOeM6znvfM5z77+c+ADrSgB03oQhv60IhOtKIXzehGO/rRkI60pCdN6Upb+tKYzrSmN83pTnv606AOtahHTepSm/rUqE61qlfN6la7+tWwjrWsZ03rWtv61rjOta53zete+/rXwA62sIdN7GIb+9jITrayl83sZjv72dCOtrSnTe1qW/va2M62trfN7W57+9vgDre4x03ucpv73OhOt7rXze52u/vd8I63vOdN73rb+974zre+983vfvv73wAPuMAHTvCCG/zgCE+4whfO8IY7/OEQj7jEJ07xilv84hjPuMY3zvGOe/zjIA+5yEdO8pKb/OQo/0+5ylfO8pa7/OUwj7nMZ07zmtv85jjPuc53zvOe+/znQA+60IdO9KIb/ehIT7rSl870pjv96VCPutSnTvWqW/3qWM+61rfO9a57/etgD7vYx072spv97GhPu9rXzva2u/3tcI+73OdO97rb/e54z7ve9873vvv974APvOAHT/jCG/7wiE+84hfP+MY7/vGQj7zkJ0/5ylv+8pjPvOY3z/nOe/7zoA+96EdP+tKb/vSoT73qV8/61rv+9bCPvexnT/va2/72uM+97nfP+977/vfAD77wh0/84hv/+MhPvvKXz/zmO//50I++9KdP/epb//rYz772t8/97nv/++APv/jHT/7ym//86E+/+tfP/va7//3wj7/850//+tv//vjPv/73z//++///ABiAATiABFiABniACJiACriADNiADviAEBiBEjiBFFiBFniBGJiBGriBHNiBHviBIBiCIjiCJFiCJniCKJiCKriCLNiCLviCMBiDMjiDNFiDNniDOJiDOriDPNiDPviDQBiEQjiERFiERniESJiESriETNiETviEUBiFUjiFVFiFVniFWJiFWriFXNiFXviFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdFiHdniHeJiHeriHfNiHfviHgBiIgjiIhFiIhniIiJiIiriIjNiIjviIkBiJkjiJlFiJlniJmJiJmriJnNiJnviJoBiKojiKpFiKpniKqJiKqriKrNiKrviKsBiLsjiLtFiLtniLuJiLuriLvNiLvviLwBiMwjiMxFiMxniMyJiMyriMzNiMzviM0BiN0jiN1FiN1niN2JiN2riN3NiN3viN4BiO4jiO5FiO5niO6JiO6riO7NiO7viO8BiP8jiP9FiP9niP+JiP+riP/NiP/viPABmQAjmQBFmQBnmQCJmQCrmQDNmQDvmQEBmREjmRFFmRFnmRGJmRGrmRHNmRHvmRIBmSIjmSJFmSJnmSKJmSKrmSLNmSLvmSMBmTMjmTNFmTNnmTOJmTOrmTPNmTPvmTQBmUQjmURFmURnmUSJmUSrmUTNmUTvmUUBmVUjmVVFmVVnmVWJmVWrmVXNmVXvmVYBmWYjmWZFmWZnmWaJmWarmWbNmWbvmWcBmXcjmXdFmXdnmXeJmXermXfNmXfvmXgBmYgjmYhFmYhnmYiJmYirmYjNmYjvmYkBmZkjmZlFmZlnmZmJmZmrmZnNmZnvmZoBmaojmapFmapnmauwkQBAA7" alt="暴露空間模式示意圖" style="max-width: 100%;">
      <p>圖3：暴露空間模式</p>
    </div>
  </div>
</div>

<script type="text/javascript">
  // 氣體常數 (mmHg * m³ / (mol * K))
  const R = 62.3637;
  
  function calculate() {
    // 獲取輸入值
    const CA_room_0 = parseFloat(document.getElementById("CA_room_0").value);
    const CA_in = parseFloat(document.getElementById("CA_in").value);
    const GA = parseFloat(document.getElementById("GA").value);
    const Q = parseFloat(document.getElementById("Q").value);
    const V = parseFloat(document.getElementById("V").value);
    const t = parseInt(document.getElementById("t").value);
    const MW = parseFloat(document.getElementById("MW").value);
    const P = parseFloat(document.getElementById("P").value);
    const T = parseFloat(document.getElementById("T").value);
    
    // 獲取暴露限值
    const TWA_value = parseFloat(document.getElementById("TWA_value").value);
    const TWA_unit = document.getElementById("TWA_unit").value;
    const STEL_value = parseFloat(document.getElementById("STEL_value").value);
    const STEL_unit = document.getElementById("STEL_unit").value;
    const IDLH_value = parseFloat(document.getElementById("IDLH_value").value);
    const IDLH_unit = document.getElementById("IDLH_unit").value;
    const OEL_value = parseFloat(document.getElementById("OEL_value").value);
    const OEL_unit = document.getElementById("OEL_unit").value;
    
    // 獲取選擇的功能
    const selectedFunction = document.querySelector('input[name="function"]:checked').value;
    
    // 計算濃度
    let concentration, avgConcentration;
    let concentrations = [];
    let times = [];
    
    // 計算每分鐘濃度
    for (let i = 0; i <= t; i++) {
      let currentConc;
      
      if (selectedFunction == "1") {
        // 功能1：時間濃度
        currentConc = CA_in + (GA/Q) + (CA_room_0 - CA_in - (GA/Q)) * Math.exp(-(Q/V)*i);
      } else if (selectedFunction == "2") {
        // 功能2：穩態濃度
        currentConc = CA_in + (GA/Q);
      } else if (selectedFunction == "3") {
        // 功能3：衰減濃度
        currentConc = CA_room_0 * Math.exp(-(Q/V)*i);
      } else if (selectedFunction == "4") {
        // 功能4：平均暴露濃度
        // 先計算時間濃度，然後取平均
        let timeConc = CA_in + (GA/Q) + (CA_room_0 - CA_in - (GA/Q)) * Math.exp(-(Q/V)*i);
        concentrations.push(timeConc);
        times.push(i);
        continue;
      }
      
      concentrations.push(currentConc);
      times.push(i);
    }
    
    // 如果是功能4，計算平均濃度
    if (selectedFunction == "4") {
      let sum = concentrations.reduce((a, b) => a + b, 0);
      avgConcentration = sum / concentrations.length;
      concentration = avgConcentration;
    } else {
      concentration = concentrations[concentrations.length - 1];
      avgConcentration = concentration;
    }
    
    // 溫度壓力修正
    let concentration_corrected = concentration * (MW * P) / (R * T);
    
    // 單位轉換
    let TWA_limit = (TWA_unit === "ppm") ? convertMgM3ToPpm(TWA_value, MW) : TWA_value;
    let STEL_limit = (STEL_unit === "ppm") ? convertMgM3ToPpm(STEL_value, MW) : STEL_value;
    let IDLH_limit = (IDLH_unit === "ppm") ? convertMgM3ToPpm(IDLH_value, MW) : IDLH_value;
    let OEL_limit = (OEL_unit === "ppm") ? convertMgM3ToPpm(OEL_value, MW) : OEL_value;
    
    // 計算暴露濃度
    let TWA_exposure = (t * concentration) / 480;
    let STEL_exposure = (t * concentration) / 15;
    
    // 顯示結果
    displayResults(concentration, concentration_corrected, TWA_exposure, STEL_exposure, 
                   TWA_limit, STEL_limit, IDLH_limit, OEL_limit, concentrations, times);
    
    // 繪製濃度趨勢圖
    plotConcentrationTrend(concentrations, times);
    
    // 風險評估
    performRiskAssessment(concentration, TWA_exposure, STEL_exposure, 
                         TWA_limit, STEL_limit, IDLH_limit, OEL_limit);
  }
  
  function convertMgM3ToPpm(mg_m3, MW) {
    // 轉換公式: ppm = (mg/m³) * (24.45 / MW)
    return mg_m3 * (24.45 / MW);
  }
  
  function convertPpmToMgM3(ppm, MW) {
    // 轉換公式: mg/m³ = ppm * (MW / 24.45)
    return ppm * (MW / 24.45);
  }
  
  function displayResults(conc, conc_corrected, TWA_exp, STEL_exp, TWA_lim, STEL_lim, IDLH_lim, OEL_lim, concentrations, times) {
    let resultsHTML = `
      <table>
        <tr><th>參數</th><th>數值</th><th>單位</th></tr>
        <tr><td>計算濃度</td><td>${conc.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>溫度壓力修正濃度</td><td>${conc_corrected.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>TWA暴露濃度</td><td>${TWA_exp.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>STEL暴露濃度</td><td>${STEL_exp.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>TWA限值</td><td>${TWA_lim.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>STEL限值</td><td>${STEL_lim.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>IDLH限值</td><td>${IDLH_lim.toFixed(4)}</td><td>mg/m³</td></tr>
        <tr><td>OEL限值</td><td>${OEL_lim.toFixed(4)}</td><td>mg/m³</td></tr>
      </table>
    `;
    
    document.getElementById("results").innerHTML = resultsHTML;
  }
  
  function performRiskAssessment(conc, TWA_exp, STEL_exp, TWA_lim, STEL_lim, IDLH_lim, OEL_lim) {
    let riskHTML = "<table><tr><th>風險類型</th><th>比較</th><th>風險等級</th><th>說明</th></tr>";
    
    // 短期暴露風險評估
    let shortTermRisk = "";
    let shortTermLevel = 0;
    
    if (conc >= IDLH_lim) {
      shortTermRisk = "超過IDLH";
      shortTermLevel = 4;
    } else if (STEL_exp >= STEL_lim) {
      shortTermRisk = "超過STEL";
      shortTermLevel = 4;
    } else {
      shortTermRisk = "未超過短期暴露限值";
      shortTermLevel = 1;
    }
    
    riskHTML += `<tr class="risk-level-${shortTermLevel}">
      <td>短期暴露風險</td>
      <td>${conc.toFixed(4)} vs ${IDLH_lim.toFixed(4)} (IDLH)<br>
          ${STEL_exp.toFixed(4)} vs ${STEL_lim.toFixed(4)} (STEL)</td>
      <td>${shortTermLevel}</td>
      <td>${shortTermRisk}</td>
    </tr>`;
    
    // 長期暴露風險評估
    let longTermRisk = "";
    let longTermLevel = 0;
    
    if (TWA_exp < TWA_lim * 0.1) {
      longTermRisk = "低於1/10 TWA";
      longTermLevel = 1;
    } else if (TWA_exp < TWA_lim * 0.5) {
      longTermRisk = "低於1/2 TWA";
      longTermLevel = 2;
    } else if (TWA_exp < TWA_lim) {
      longTermRisk = "低於TWA";
      longTermLevel = 3;
    } else {
      longTermRisk = "超過TWA";
      longTermLevel = 4;
    }
    
    riskHTML += `<tr class="risk-level-${longTermLevel}">
      <td>長期暴露風險</td>
      <td>${TWA_exp.toFixed(4)} vs ${TWA_lim.toFixed(4)} (TWA)</td>
      <td>${longTermLevel}</td>
      <td>${longTermRisk}</td>
    </tr>`;
    
    // OEL風險評估
    let OELRisk = "";
    let OELLevel = 0;
    
    if (conc < OEL_lim * 0.1) {
      OELRisk = "低於1/10 OEL";
      OELLevel = 1;
    } else if (conc < OEL_lim * 0.5) {
      OELRisk = "低於1/2 OEL";
      OELLevel = 2;
    } else if (conc < OEL_lim) {
      OELRisk = "低於OEL";
      OELLevel = 3;
    } else {
      OELRisk = "超過OEL";
      OELLevel = 4;
    }
    
    riskHTML += `<tr class="risk-level-${OELLevel}">
      <td>OEL風險</td>
      <td>${conc.toFixed(4)} vs ${OEL_lim.toFixed(4)} (OEL)</td>
      <td>${OELLevel}</td>
      <td>${OELRisk}</td>
    </tr>`;
    
    riskHTML += "</table>";
    
    document.getElementById("riskAssessment").innerHTML = riskHTML;
    
    // 建議控制措施
    let recommendations = "<div class='recommendation'>";
    
    if (shortTermLevel === 4) {
      recommendations += "<p><strong>立即危害控制措施：</strong></p>";
      recommendations += "<ul>";
      recommendations += "<li>立即停止作業並撤離人員</li>";
      recommendations += "<li>使用自給式呼吸器(SCBA)</li>";
      recommendations += "<li>加強局部排氣裝置</li>";
      recommendations += "<li>考慮工程控制措施(密閉化、自動化)</li>";
      recommendations += "</ul>";
    }
    
    if (longTermLevel === 4 || OELLevel === 4) {
      recommendations += "<p><strong>長期暴露控制措施：</strong></p>";
      recommendations += "<ul>";
      recommendations += "<li>改善通風系統，增加換氣率</li>";
      recommendations += "<li>使用適當的呼吸防護具</li>";
      recommendations += "<li>實施作業環境監測</li>";
      recommendations += "<li>進行健康管理與教育訓練</li>";
      recommendations += "<li>考慮替代較安全物質</li>";
      recommendations += "</ul>";
    } else if (longTermLevel === 3 || OELLevel === 3) {
      recommendations += "<p><strong>中等風險控制措施：</strong></p>";
      recommendations += "<ul>";
      recommendations += "<li>定期維護通風系統</li>";
      recommendations += "<li>提供適當個人防護裝備</li>";
      recommendations += "<li>實施定期環境監測</li>";
      recommendations += "<li>加強作業人員教育訓練</li>";
      recommendations += "</ul>";
    } else {
      recommendations += "<p>當前暴露風險較低，建議維持現有控制措施並定期監測。</p>";
    }
    
    recommendations += "</div>";
    
    document.getElementById("recommendations").innerHTML = recommendations;
  }
  
  function plotConcentrationTrend(concentrations, times) {
    // 使用Plotly繪製濃度趨勢圖
    let data = [{
      x: times,
      y: concentrations,
      type: 'scatter',
      mode: 'lines+markers',
      marker: {color: 'blue'},
      line: {color: 'blue'}
    }];
    
    let layout = {
      title: '濃度隨時間變化趨勢',
      xaxis: {
        title: '時間 (分鐘)',
        showgrid: true
      },
      yaxis: {
        title: '濃度 (mg/m³)',
        showgrid: true
      }
    };
    
    Plotly.newPlot('concentrationPlot', data, layout);
  }
</script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
